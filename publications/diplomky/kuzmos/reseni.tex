\chapter{Øešení}
\label{implementation}
\section{Vztah diplomové práce ''Experimentální GUHA procedury'' k této práci}
Zde se podrobnì uvede vztah diplomové práce T.Kuchaøe ''Experimentální GUHA procedury''
uvedené v seznamu pouité literatury jako \cite{kuchar}.
\subsection{GUHA v prostøedí Ferda DataMiner}
Jak se u podrobnìji uvedlo v kapitole \ref{ferdaproject}, Ferda DataMiner
vznikl jako studentskı projekt s cílem implementace obecnìjší platformy
pro datamining se základním prvkem pojmenovanım krabièka, viz \cite{ferda}
pro podrobnìjší informace.
\paragraph{}
V dobì jeho vzniku ji byly získány rozsáhlé uivatelské
zkušenosti se systémem LISp-Miner a Ferda DataMiner byl navren s ohledem
na tyto zkušenosti. Projektovı tım se zamìøil na vìtší obecnost prostøedí,
kde by bylo moné implementovat i jiné dataminingové metody ne GUHA. Zároveò
v rámci tého projektu byla implementována metoda GUHA s pouitím ji
existujících modulù prostøedí LISp-Miner. To pøináslo øadu potíí podrobnì
popsanıch T.Kuchaøem v \cite{kuchar} a proto bylo evidentní, e GUHA
se musí v prostøedí Ferda DataMiner implementovat bez vyuití modulù
z LISp-Mineru. Pouze tak mohly bıt vyuity všechny vıhody prostøedí Ferda DataMiner.
\paragraph{}
Implementaci šesti GUHA procedur a modulù pro zadání úlohy implementoval
T.Kuchaø ve své diplomové práci ''Experimentální GUHA procedury'',
jak u zde bylo nìkolikkrát zmínìno.
\paragraph{}
Daná diplomová práce je rozšíøením existujících (tzn. v prostøedí
Ferda DataMiner implementovanıch) dataminingovıch procedur. Sdílí
jak zpùsob zadávání úlohy, tak i nìkteré èásti procedur. Vzhledem
k odlišné povaze generování relevantních otázek nebylo
moné vyuit jedné z hlavních vıhod existující implementace
GUHA procedur v prostøedí Ferda DataMiner a to cache bitovıch
øetízkù. Dále existující implementace musela bıt rozšíøena
o monost práce s bitovımi øetízky na odlišném principu
ne bylo dosud implementováno.
\section{Zásady implementace}
Zde bude popsán obecnı programátorskı pøístup k øešení implementace.
\subsection{License}
Protoe prostøedí Ferda DataMiner je vıvíjeno pod licensi
GNU Public License (GPL), implementace v rámci dané diplomové práce
je rovnì vyvíjeno pod licensi GPL. Daná license umoòuje
nejen volné pouití programu, ale také zaruèuje volnı pøístup
ke zdrojovému kódu programu a jeho rozšíøování pod podmínkou,
e vıslednı kód bude rovnì pod GPL licensi. Plnı text GNU
Public License lze nalézt na \verb+http://www.gnu.org/licenses/gpl.txt+.
\subsection{Platforma}
Implementace v rámci dané diplomové práce byla napsána
v jazyce C\# stejnì jako stávající implementace prostøedí
Ferda DataMiner. Jedním z cílù (u od doby studentského projektu)
je spustitelnost prostøedí Ferda DataMiner na více platformách.
Pod OS Windows lze vyuít platformu Microsoft .NET Framework
(\verb+http://www.microsoft.com/cze/net/+),
na jinıch operaèních systémech (napøíklad Linux nebo
MacOS) pak prostøedí Mono (\verb+http://www.mono-project.com+).
\paragraph{}
Prostøedí Ferda DataMiner bylo navreno modulárnì. Jeho jednotlivé
èásti mezi sebou komunikují pøes middleware Internet Communications
Engine ICE (\verb+http://www.zeroc.com+), co je moderní alternativa
podobnému frameworku CORBA a podporuje nìkolik rozšíøenıch programovacích
jazykù, mezi které patøí také C\#.
\subsection{Vıkonnostní testy}
Souèástí dané diplomové práce je øada testù
relaèních rozšíøení dataminingovıch procedur. Testy
se zamìøí na hranice únosnosti zadání úlohy
ve smyslu doby bìhu, na vliv velikosti zpracovávané
datové matice na bìh relaèních rozšíøení a také
na dùleitost vyuití cache pro generované bitové
øetízky virtuálním atributem. V úplnì pùvodním
návrhu implementace se s cache vùbec nepoèítalo
z dùvodù uvedenıch dále, proto testy zahrnují
i bìh úlohy s vypnutou cache pro ilustraci zdùvodnìní
její zavedení navzdory pùvodnímu návrhu.
\subsection{Dokumentace}
\subsubsection{Uivatelská dokumentace}
Uivatelská dokumentace je zahrnutá v daném textu
jako popis implentovanıch krabièek.
\subsubsection{Programátorská dokumentace}
Obecnı návrh øešení je souèástí textu dané diplomové práce.
Poznámky pøímo k detailem implementaci jsou souèástí zdrojového kódu.
\section{Agregaèní atribut}
\subsection{Popis úlohy}
\subsection{Diskuze nad implementaci}
\section{Hypotézovı atribut}
Zde bude popsána podstata úlohy, kterou bylo nutné
vyøešit pro implementaci hypotézového atributu v prostøedí
Ferda DataMiner. Protoe vısledná idea implementace byla
nalezena a upøesnìna a bìhem nìkolika schùzí s vedoucím diplomové
práce, autor povauje za nezbytné tuto diskuzi zde krátce uvést,
co dle jeho názoru pomùe k lepšímu pochopení dùvodù
volby návrhu, kterı nakonec pøevládl a byl tedy v rámci dané
diplomové práce implementován. Bude následovat rozbor
dopadu zvoleného zpùsobu pro stávající i budoucí aspekty
implementace relaèních rozšíøení v prostøedí Ferda DataMiner.
\subsection{Popis úlohy}
Jak u bylo podrobnì popsáno v sekci \ref{vattributes}, hypotézovı
virtuální atribut (kterému budeme také øíkat podúloha)
pracuje nad vedlejší datovou matici, ve které
zkoumá zajímavé vztahy pro øádky dané datové matice patøící k objektu
v hlavní datové matici. Podúloha se spustí mnohokrát a pokadé
vygeneruje relevantní otázku pouze pro èást vedlejší datové matice.
Vısledkem pro hlavní úlohu, do které je takovı virtuální atribut zapojen,
bude síla hypotézy vzniklé ze zmínìné relevantní otázky aplikací
kvantifikátoru zapojeného do podúlohy.
\paragraph{}
Podúloha se vdy spouští pro ty øádky vedlejší datové matice, které
jsou v relaci s objektem z hlavní datové matice. Jako pøíklad
uvedeme podúlohu, která bìí na tabulce transakcí. Vdy se spustí
pouze pro øádky transakcí patøící urèitému klientovi. Nad tìmi probìhne
verifikace nìjaké (poøadí generování se bude odvíjet od zpùsobu implementace)
relevantní otázky generované podúlohou a jako vısledek podúloha vydá obecnì
reálné èíslo znamenající validitu dané hypotézy na zkoumané podmnoinì
øádkù vedlejší datové matice.
\paragraph{}
To znamená, e pro kadı objekt z hlavní datové matice podúloha zkoumající
vedlejší datovou matici vrátí právì jedno reálné èíslo. Takto vzniklı
sloupec se pro nadúlohu nebude nijak líšit od regulerního sloupce hlavní datové matice
a bude tedy zahrnut do generování relevantních otázek a potamo i hypotéz v nadúloze.
\subsection{Diskuze nad implementaci}
Z vıše popsaného je jasné, e implementace musí vyøešit nìkolik problému.
Jejich øešení bylo podrobnì diskutováno s vedoucím diplomové práce Doc. RNDr. Janem Rauchem, CSc.
pøiblinì v následujících bodech.
\paragraph{}
Pro zaèátek si ještì jednou pøipomeneme základní algoritmus generování
relevantních otázek a ovìøování hypotéz pro dataminingovou proceduru 4ft miner.
\begin{verbatim}
foreach(BitString condition in Conditions)
{
    foreach(BitString antecedent in Antecedents)
    {
        foreach(BitString succedent in Succedents)
        {
            ContingencyTable table = 
                ComputeTable(succedent, antecedent, condition);
            if (VerifyQuantifiers(table))
                result.Add(succedent, antecedent, condition);
        }
    }
}

\end{verbatim}

\subsubsection{Zpùsob bìhu podúlohy}
Bìhem diskuze se vykrystalizovaly následující tøi pøístupy, jak mùe podúloha bìet.
\begin{description}
\item[Pøedbìné generování]
Podúloha by se spouštìla pøedem na vedlejší datové matici. Vısledky ve formì
buï virtuálních sloupcù a(nebo) bitovıch øetízkù by se pøechodnì skladovaly
v pamìti èi ve formì serializovanıch objektù a pøi následném bìhu nadúlohy
by se této pøedloily. Podobnım zpùsobem jsou implementovány napøíklad
stávající nevirtuální atributy - ''Each value one category'', ''Ekvidistanèní intervaly''
a ''Ekvifrekvenèní intervaly''.
\paragraph{}
Vıhodou takového pøístupu by byla monost vyuít stávající vıhody implementace
metody GUHA v prostøedí Ferda DataMiner a to zejména cache bitovıch øetízkù.
Dále by se mohly bez vìtších zmìn pouít dataminingové procedury jako podúlohy,
v podstatì by se jednalo o jejich spuštìní na podmnoinì datové matice místo
na celé mnoinì øádkù. Také takto implementovanı virtuální atribut by šel
zapojít do zadání pro všechny dosud implementované GUHA dataminingové
procedury v prostøedí Ferda DataMiner.
\paragraph{}
Hlavním dùvodem napsání pøedchozího odstavce v podmíòovacím zpùsobu
se stala nemonost škálovatelnosti takového øešení. U i pro existující
vzorová data virtuální banky Barbora mohl nastat problém se zabíranou
pamìti pro vygenerované bitstringy. Poèet relevantních otázek v zadané
dataminingové úloze v øádu tisícù èi desetitisícù je bìnou záleitostí.
Protoe kadá relevantní otázka v podúloze znamená novı virtuální sloupec
v hlavní tabulce, nad kterou bìí hlavní dataminingová úloha, pøi úvaze
o velikosti poadované operaèní pamìti (protoe bitové øetízky krabièky
atributù ve Ferda DataMiner drejí právì tam) se musí poèet sloupcù
vynásobit poètem øádku hlavní datové matice.
\paragraph{}
Pøi úvaze s matici banky Barbora o velikosti øádovì kolem 5000 øádku
a poètem relevantních otázek v podúloze kolem 10000 nám vzníká ještì vcelku
pøijatelná velikost zabírané RAM, nicménì je tøeba si uvìdomit, e velikost
zkoumané datové tabulky pro úlohy blíící se reálné situaci je spíše v øádech
statisícù a miliónù záznamù. Toto je zásadní omezení pro budoucí aplikace
prostøedí Ferda DataMiner a takto navrenı zpùsob implementace by omezil nejen
relaèní rozšíøení procedur implementovanıch v rámci dané diplomové práce,
ale i pøípad\-nıch dalších implementací relaèních rozšíøení v budounu.
\paragraph{}
Z vıše uvedenıch dùvodù bylo tedy od tohoto zpùsobu implementace upuštìno.
\item[Èekající vlákna]Po zavrení pøedchozího pøístupu bylo jasné, e øešení
pøedgenerovat si bitstringy do pamìti nepøipadá v úvahu. Zaèal se hledat
zpùsob, jak virtuální sloupce a tedy i bitové øetízky, generovat prùbìnì,
vdy na pokyn nadúlohy.
\paragraph{}
Vznikla následující úvaha: protoe nadúloha potøebovala ke zpracování celı
sloupec hlavní datové matice najednou, podúloha by mohla bìet
jako dataminingová procedura v samostatném vláknì, která by jako vstup mìla
právì jednu podmnoinu øádkù vedlejší datové matice pro jeden obejkt z hlavní
datové matice. Tedy pro kadı objekt z hlavní datové matice by bìelo
jedno vlákno podúlohy, které by postupnì vracelo reálná èísla, která by se formovala
do virtuálních sloupcù.
\paragraph{}
Skoro na první pohled je však jasné, e by muselo bıt spuštìn stejnı poèet vláken
jako poèet øádkù v hlavní datové matici. Idea nutnosti øádovì tisíce vláken pro vıpoèet
by jednoduché úlohy (i nad tabulkou virtuální banky Barbory) se autorovi dané
diplomové práce zdala jako velmi špatnì navrena z dùvodù pøíliš velké
reie operaèního systému na pøepínaní takového poètu vláken. Z dosavadních
zkušeností je vidìt, e na bìnì dostupném osobním poèítaèi øádovì i stovka vláken
vìtšinou pøedstavuje velké vytíení komponent systému.
\paragraph{}
Z vıše uvedenıch dùvodù bylo tedy od tohoto zpùsobu implementace upuštìno.
\item[Generování po krocích]
Pøedchozí úvaha však inspirovala autora práce k jinému pøístupu k øešení. Jak je vidìt
z algoritmu generování relevantních otázek, kterı je uveden na poèátku této sekce,
dataminingová úloha (v tomto pøípadì nadúloha) potøebuje v jednotlivıch krocích svıch cyklù pouze
\emph{jeden bitovı øetízek}. Z tohoto vznikla idea navrhnout dataminingovou proceduru pro podúlohu tak, aby umìla
poskytnout na poádání ne nìjakı konkrétní sloupec nebo bitovı øetízek, nıbr \emph{další} sloupec
a \emph{další} bitovı øetízek anebo nic v pøípadì vyèerpání monıch sloupcù.
\paragraph{}
Zásadní rozdíl oproti dosud existujícím (nevirtuálním) atributùm byl ten, e tyto mìly
celou mnoinu svıch bitovıch øetízkù v okamiku pøed zaèátkem generování známou. Bitové
øetízky jsou v tìchto atributech identifikovatelné dle klíèe skladájíciho se z id atributu a názvu
kategorie. Je znám celkovı poèet bitovıch øetízkù, tudí lze stanovit poèet celkovì vygenerovanıch
relevantních otázek. Je moné pøistoupit k jakémukoliv bitovému øetízku na základì klíèe.
\paragraph{}
Oproti tomu navrhovanı zpùsob implementace hypotézového atributu zaruèoval pouze to,
e takovı atribut v okamiku zavolání pøíslušné metody buï vydá další bitovı øetízek
nebo oznámí, e bitové øetízky u vydávat nebude. Není tedy známá a snadno pøístupná
celá mnoina bitovıch øetízku pøed zaèátkem generování (nadúlohou) relevantních otázek.
Tudí nelze spoèítat ani pøedpokládanı poèet vygenerovanıch relevantních otátek,
protoe hypotézovı atribut jednoduše reaguje buï tím, e dá další bitovı øetízek
nebo oznámí, e øetízky došly.
\paragraph{}
Vıhody tohoto øešení ve smyslu škálovatelnosti jsou zøejmé. Podúloha bìí synchronnì
s nadúlohou a v pamìti se uchovává a pøedává pouze jeden bitovı øetízek v jednom okamiku.
Poté, co nadúloha pøejde na další krok generování a poádá virtuální atribut o další bitovı øetízek,
tento zavolá svoji metodu MoveNext a vydá další øetízek. Pøedchozí vygenerované øetízky
se nikde neukládají a nezabírají pamì.
\paragraph{}
Nevıhody tohoto øešení jsou ji naznaèeny
vıše a budou podrobnìji probrány dále. Po diskuzi s vedoucím diplomové práce se autor rozhodl
implementovat relaèní rozšíøení dataminingovıch procedur právì tímto zpùsobem,
protoe pøípadné nevıhody a jinı pøístup k øešení znamenaly spíše nepohodlí pro programátora, avšak
nijak nenarušovaly princip metody GUHA jako takové. Navíc poskytovaly základní vıhodu
škálovatelnosti -- z principu návrhu lze zaruèit, e úloha skonèí i na velkıch tabulkách,
nevyèerpá RAM nebo poèet povolenıch bìicích vláken v systému. Mùe se stát, e
pobìí delší dobu, ale skonèí korektnì.
\end{description}
\subsection{Dùsledky zvoleného zpùsobu}
Zde budou popsány dùsledky, které mìlo zvolené øešení implementaci a spolupráci
s ji existujícími moduly metody GUHA v prostøedí Ferda DataMiner.
\subsubsection{Vypnutí cache bitovıch øetízku}
Nejpodstatnìjším dùsledkem byla nemonost pouívat stávající cache bitovıch
øetízkù. Ta totí funguje tak, e uchovává bitové øetízky pro atributy
(pro všechny atributy je spoleèná) a v pøípadì potøeby vyøazuje z cache
málo pouívané bitové øetízky na základì nìjaké strategie. V pøípadì,
e v cache potøebnı bitovı øetízek neexistuje, poádá o nìj pøímo
potøebnı atribut na základì jednoznaèného identifikátoru.
\paragraph{}
Jak u bylo zmínìno vıše, takovı pøístup by se zvolenım zpùsobem implementace
nefungoval -- pøedpokládá totí monost pøístupu ke všem bitovım øetízkùm
atributu. Návrh hypotézového virtuálního atributu s tímto nepoèítá -- umí
dát pouze ''další'' bitovı øetízek bez monosti zjistit, kterı další to bude, jakı
bude mít identifikátor, ke které kategorii bude patøit atd. Z tìchto dùvodù
nešlo stávající cache pro hypotézovı virtuální atribut pouit. Pouití
cache bitovıch øetízkù u ostatních buï existujících nebo novì implementovanıch
krabièek atributù zùstalo beze zmìny, protoe se pro tyto krabièky nic nezmìnilo.
\subsubsection{Rozdìlení na krabièky}
Další úvahou bylo, zda implementovat hypotézovı virtuální atribut
jako dvì krabièky nebo jednu spoleènou. Stávající nevirtuální
atributy se v pøípadì potøeby generování boolskıch atributù zapojují do krabièky
''AtomSetting''. Ta zajistí generování koeficientù pro booleovskı atribut.
\paragraph{}
V pøípadì hypotézového virtuálního atributu by nešla pouít stávající krabièka
pro generování koeficientù ''AtomSetting'', protoe pracuje s poadavkem ''poskytni
pøesnì tento bitovı øetízek'', kdyto hypotézovı atribut by umìl zpracovat pouze
poadavek ''poskytni další bitovı øetízek''. Tudí krabièka pro generování koeficientù
vyuitelná pouze pro hypotézovı virtuální atribut by se se musela také naprogramovat.
\paragraph{}
Po úvaze se autor rozhodl neimplementovat zvláštní krabièku pro generování
koeficientù pro hypotézovı virtuální atribut z následujících dùvodù.
\begin{description}
\item[Potøeba pouze jednoho koeficientu] Po diskuzi s vedoucím práce
bylo rozhodnuto, e pøi generování koeficientù pro booleovskı atribut
bude potøeba implementovat pouze podmnoiny délky jedna -- viz \ref{coefficients}.
Krabièka ''AtomSetting'' pro hypotézoví virtuální atribut by byla nadbyteèná,
protoe by tam chybìlo uivatelské nastavení, vše se odehrávalo ''pod kapotou''.
Nebyl tedy dùvod tuto krabièku vytváøet.
\item[Nadbyteèná komunikace krabièek pøes ICE] Navíc by tato krabièka, která
by se napojila za hypotézovı virtuální atribut, znamenala komunikaci pøes ICE.
Protoe idea implementace spoèívá v synchronním bìhu nad- a podúlohy, kde
nadúloha uvnitø svıch cyklù (napøíklad pro sukcedent) volá podúlohu, která jí
pøedává bistringy, je potøeba zajistit toto pøedávání plynule, aby
se hlavní úloha pøíliš nezpomalovala èekáním na bitstring od podúlohy. Protoe
ze zkušeností získanıch pøi programování prostøedí Ferda DataMiner ještì
jako studentského projektu autor vìdìl, e komunikace krabièek pøes
rozhraní ICE je pomalá, bylo rozhodnuto zajistit generování atributu
a koeficientu v jedné krabièce a tím zrychlit bìh hypotézového
virtuálního atributu.
\end{description}
\subsubsection{Buffer bitovıch øetízkù}
Pøi ladìní prvotní implementace hypotézového virtuálního atributu
se zjistilo, e aèkoliv zvolenı návrh zaruèí škálovatelnost
a jistotu toho, e úloha by za delší dobu dobìhne a nezabere
zbyteènou pamì, doba bìhu celkové úlohy je neúmìrnì dlouhá.
