\chapter{Testy}
\label{tests}
\paragraph{}
V této kapitole bude popsán vliv rùzných faktorù na bìh
úlohy s použitím relaèního rozšíøení dataminingové procedury.
Autor bude zkoumat vliv zej\-mé\-na velikosti dat a poètu vygenerovaných
virtuálních sloupcù. Také se ukáže, že použití
bufferu pro bitové øetízky vygenerované virtuálním at\-ri\-bu\-tem je z hlediska
výkonu nezbytné.

\section[Zkoumaná data]{Zkoumané datové matice}
\paragraph{}
Zkoumaná data vychází z databáze fiktivní banky \uv{Barbora} používané
pù\-vod\-nì v projektu LISp-Miner a dále Ferda DataMiner. Databáze obsahuje
data o fiktivních klientech, jejich pohlaví, místa bydlištì, transakcích, pùjè\-kách atd.
\subsection[Hlavní matice]{Hlavní datová matice}
\paragraph{}
Hlavní datová matice s názvem \uv{Client\_Loans} obsahuje údaje o jednotlivých klientech.
Velikost této datové matice je kolem 700 øádkù.
Následující tabulka obsahuje popis sloupcù hlavní datové matice.

\begin{table}[!h]
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
Název sloupce & Typ sloupce & Popis sloupce \\
\hline
client\_id & Dlouhé celé èíslo & Identifikátor klienta  \\
\hline
loan\_id & Dlouhé celé èíslo & Identifikátor pùjèky klienta  \\
															&&	(modelována situace, \\
															&&	 kde každý klient má jednu pùjèku)\\
\hline
account\_id & Dlouhé celé èíslo & Identifikátor úètu klienta  \\
															&&	(modelována situace, \\
															&&   kde každý klient má jeden úèet)\\
\hline
date & Dlouhé celé èíslo & Datum založení úètu  \\
\hline
amount & Dlouhé celé èíslo & Velikost pùjèky  \\
\hline
duration & Dlouhé celé èíslo & Doba pùjèky  \\
\hline
payments & Dlouhé celé èíslo & Výše splátky  \\
\hline
status & text & Kvalita dluhu (subjektivní hodnocení)  \\
\hline
birth\_number & Dlouhé celé èíslo & Rodné èíslo  \\
\hline
DistrictID & Dlouhé celé èíslo & Identifikátor bydlištì  \\
\hline
District & text & Bydlištì \\
\hline
Region & text & Region \\
\hline
Inhabitants & Dlouhé celé èíslo & Poèet obyvatel  \\
\hline
Muni499 & Dlouhé celé èíslo & Poèet obcí v regionù  \\
														&& s maximálnì 499 obyvateli \\
\hline
Muni1999 & Dlouhé celé èíslo & Poèet obcí v regionù  \\
														&& s maximálnì 1999 obyvateli \\
\hline
Muni9999 & Dlouhé celé èíslo & Poèet obcí v regionù  \\
														&& s maximálnì 9999 obyvateli \\
\hline
MuniOver & Dlouhé celé èíslo & Poèet obcí v regionù  \\
														&& s více než 9999 obyvateli \\

\hline
Cities & Dlouhé celé èíslo & Poèet mìst v regionu \\
\hline
PopulationRation & Dlouhé celé èíslo &\\
\hline
Salary & Dlouhé celé èíslo & Prùmìrný plat v regionu\\
\hline
Unemployment95 & Dlouhé celé èíslo & Nezamìstnanost v regionu v roce 1995\\
\hline
Unemployment96 & Dlouhé celé èíslo & Nezamìstnanost v regionu v roce 1996\\
\hline
EnterpreneursRation & Dlouhé celé èíslo & Podnikatelé v regionu \\
\hline
Crimes95 & Dlouhé celé èíslo & Kriminalita v regionu v roce 1995\\
\hline
Crimes96 & Dlouhé celé èíslo & Kriminalita v regionu v roce 1996\\
\hline
\end{tabular}
\end{center}
\caption{Sloupce hlavní datové matice \uv{Client\_Loans}}
\end{table}
\clearpage



\subsection[Vedlejší matice]{Vedlejší datová matice}
\paragraph{}
Vedlejší datová matice \uv{trans\_pro\_client\_loan} obsahuje transakce pro klienty
z tabulky \uv{Client\_Loans}. Pro úèely testování je tato tabulka obsažena
v databází ve tøech verzích: malá, støední a velká, kde poèet øádkù 
pro jednotlivé verze je
pøibližnì 10000, 70000 a 200000.
\paragraph{}
Následující tabulka obsahuje popis sloupcù vedlejší datové matice.

\begin{table}[!h]
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
Název sloupce & Typ sloupce & Popis sloupce \\
\hline
trans\_id & Dlouhé celé èíslo & Identifikátor transakce  \\
\hline
client\_id & Dlouhé celé èíslo & Identifikátor klienta  \\
\hline
account\_id & Dlouhé celé èíslo & Identifikátor úètu  \\
\hline
date & Dlouhé celé èíslo & Datum transakce  \\
\hline
type & text & Typ transakce (pøíjem, výdej   \\
&&nebo výbìr)\\
\hline
operation & text & Typ operace (pøevod z / na úèet,   \\
&&výbìr, vklad nebo výbìr kartou)  \\
\hline
Amount & Dlouhé celé èíslo & Velikost transakce  \\
\hline
Balance & Dlouhé celé èíslo & Zùstatek  \\
\hline
k\_symbol & Dlouhé celé èíslo & Konstantní symbol (úèel transakce,   \\
&&napø. inkaso)\\
\hline
bank & text & Zdrojová nebo cílová banka transakce  \\
\hline
account & Dlouhé celé èíslo & Zdrojový nebo cílový úèet transakce  \\
\hline
\end{tabular}
\end{center}
\caption{Sloupce vedlejší datové matice \uv{trans\_pro\_client\_loan}}
\end{table}

\section[Úloha]{Východiska zadání a zadaná úloha}
\paragraph{}
Základní inspirací pro úlohu pro relaèní rozšíøení procedur 4FT a SD4FT bylo zjistit nìjaké údaje
o objektech z hlavní datové matice na základì údajù z vedlejší datové matice.
V našem pøípadì hledáme nìjaké vztahy v matici klientù na základì údajù
jak v hlavní matici klientù, tak i ve vedlejší matici jejich transakcí.
Pomocí procedury SD4FT zkoumáme rozdíly mezi dvìma množinami.
\paragraph{}
Na základì údajù obsažených ve zkoumaných datových maticích a po diskuzi
s vedoucím práce bylo rozhodnuto zaèít od jednodušších úloh pro
relaèní proceduru a zapojovat je do úlohy pro (nerelaèní) 4FT. V úlohách se zkoumá
status úvìru v závislosti na rùzných parametrech. Zde pøedpokládáme a chceme najít
nìjaké zajímavé závislosti statusu pùjèky na charakteristice plateb klienta, jak bylo podrobnìji uvedeno v kapitole \ref{hypattr}.

\subsection[4FT virtuální atribut]{4FT virtuální booleovský atribut}
\subsubsection[Úloha 1]{Úloha 1}
\paragraph{}
Úloha je zadaná pro proceduru 4FT následujícím zpùsobem:

\begin{equation*}
District \& Salary \& \emph{TypeImplAmount} \Rightarrow_{0,9;50} LoanStatus
\end{equation*}

$\Rightarrow_{0,9;50}$ je v tomto pøípadì kvantifikátor fundované implikace $Founded\-implication$
a \emph{TypeImplAmount} je virtuální 4FT atribut s následujícím za\-dá\-ním:

\begin{equation*}
Type \Rightarrow_{0,9;5} Amount
\end{equation*}

$\Rightarrow_{0,9;5}$ je v tomto pøípadì rovnìž kvan\-ti\-fi\-ká\-tor
fun\-do\-va\-né imp\-li\-ka\-ce $Found\-ed\-imp\-li\-ca\-tion$.


\subsection[Výsledky testù]{Výsledky testù}
\paragraph{}
V následujících tabulkách jsou uvedeny doby bìhu úloh
s rùznými velikostmi vedlejší datové matice a poètem relevantních
otázek vygenerovaných relaèním 4ft booleovským atributem.
\paragraph{}
Každý test se pouštìl tøikrát a výsledný èas se zprùmìroval. Mezi každým spuštìním
Ferda DataMiner byl restartován, aby byly zachovány stejné pod\-mín\-ky pro jednotlivé
bìhy (bez tohoto by se pøi druhém a dalším spuštìní naèítaly informace pro krabièky z cache).
V uvedené tabulce \ref{tab:test4ft} \emph{Transakce} znamená bìh úlohy na vedlejší
matici transakcí o rùzných velikostech a \emph{\#~vir.sloupcù} je poèet
virtuálních sloupcù vy\-ge\-ne\-ro\-va\-ných kra\-biè\-kou virtuálního atributu.
\subsubsection{Úloha 1}
\begin{table}[!h]
\begin{center}
\begin{tabular}{|l|l|l|l|}
\hline
Transakce / & malé & støední &  velké  \\
\# vir.sloupcù&&&\\
\hline
16 & 14s & 25s & 1m 10s\\
\hline
50 & 15s & 25s & 1m 32s \\
\hline
80 & 9m 2s & 11m 11s& 12m 2s\\
\hline
100 & 12m & 24m & 1h 3m \\
\hline
\end{tabular}
\end{center}
\caption{Test relaèní procedury 4FT: úloha 1}
\label{tab:test4ft}
\end{table}

\subsubsection{Úloha 1 -- bez cache}
\paragraph{}
Zde byla zkoumána rych\-lost práce bez cache. Porovnáním s pøed\-chozí tabul\-kou lze zjistit
èasové roz\-díly bìhu úlohy.
\begin{table}[!h]
\begin{center}
\begin{tabular}{|l|l|l|l|}
\hline
Transakce / & malé & støední &  velké   \\
\# vir.sloupcù&&&\\
\hline
16 & 21s & 1m8s & 6m 45s\\
\hline
50 & 45s & 3m 5s & 26m 33s \\
\hline
100 & 50m 30s & 9h 52m& --\footnotemark  \\
\hline
\end{tabular}
\end{center}
\caption{Test relaèní procedury 4FT: úloha 1 -- bez cache}
\end{table}


\subsection[SD4FT atribut]{SD4FT virtuální booleovský atribut}
\subsubsection[Úloha 2]{Východiska zadání a zadaná úloha 2}
\paragraph{}
Úloha je zadaná pro 4FT následujícím zpùsobem:

\begin{equation*}
District \& Salary \& \emph{TypeImplAmountBank} \Rightarrow_{0,9;50} LoanStatus
\end{equation*}

$\Rightarrow_{0,9;50}$ je v tomto pøípadì kvantifikátor fundované implikace $Founded\-implication$
a \emph{TypeImplAmountBank} je virtuální SD4FT booleovský atribut s následujícím zadáním:

\begin{equation*}
Type \Rightarrow_{0,9;5} Amount (Bank)
\end{equation*}

$\Rightarrow_{0,9;5}$ je v tomto pøípadì rovnìž kvan\-ti\-fi\-ká\-tor
fun\-do\-va\-né imp\-li\-ka\-ce $Found\-ed\-imp\-li\-ca\-tion$.
\subsection[Výsledky testù]{Výsledky testù}
\paragraph{}
V následujících tabulkách jsou uvedeny doby bìhu úloh
s rùznými velikostmi vedlejší datové matice a poètem virtuálních sloupcù vygenerovaných relaèním SD4FT booleovským atributem.
\begin{table}[!h]
\begin{center}
\begin{tabular}{|l|l|l|l|}
\hline
Transakce / & malé & støední &  velké \\
\# vir.sloupcù&&&\\
\hline
16 &8m01s&13m05s&21m30s\\
\hline
40 &16m12s&28m57s&29m30s\\
\hline
80 &25m40s&35m20s&58m05s\\
\hline
100 &30m34s&55m50s&1h13m50s\\
\hline
\end{tabular}
\end{center}
\caption{Test relaèní procedury SD4FT: úloha 2}
\end{table}
\footnotetext{Vzhledem k velmi dlouhé pøedpokládané dobì bìhu
test nebyl spouštìn}

\section{Výsledky}
\paragraph{}
Výsledkem úlohy byly 4FT (resp. SD4FT) hypotézy (obrázek \ref{fig:4ftresult}), kde vir\-tuál\-ní atribut byl souèásti zadání antecedentu
úlohy pro proceduru 4FT. Jako hodnota virtuálního atributu je uvedeno znìní asociaèního pravidla, které platí na podmnožinì
øádkù vedlejší datové matice (viz diskuzi v kapitole \ref{vattributes}). O zadání úlohy a zpùsobu interpretace získaných hypotéz probìhla krátká diskuze
s vedoucím práce. Její výsledkem bylo konstatování faktu, že hypotézy nalezené s použitím relaèního atributu se obtížnì
\uv{pøekládají} do pøirozeného jazyka. Ze zadání úlohy jsme získali nìjaká tvrzení o faktech, které platí pro klienty
z hlavní datové tabulky, na základì faktù, která platí pro podmnožiny øádkù ve vedlejší datové tabulce.

\begin{figure}[!h]
\begin{center}
\includegraphics[width=15cm]{pics/4ft-result}
\end{center}
\caption{Výsledky bìhu úlohy s použitím 4FT virtuálního atributu}
\label{fig:4ftresult}
\end{figure}
\paragraph{}

Zkoumejme získanou hypotézu s id 0 z výsledku bìhu úlohy 1, která vypadá takto:
\begin{description}
\item[Antecedent:] Salary($\langle 8110;8402)$) \& V-FFT-Bool([ant]: OP(PREVOD NA UCET),  *** [succ]: amount(Nizky vklad)) \& District(Vyskov)	
\item[Sukcedent:] status(Good)
\end{description}
kde pro virtuální atribut platí:
\begin{description}
\item[Antecedent:] OP(PREVOD NA UCET)	
\item[Sukcedent:] amount(Nizky vklad)
\end{description}
\paragraph{}
Tato hypotéza mùže znamenat, že pro klienty z Výškova, kteøí \emph{mají tendenci pøevádìt na úèet menší èástky} a mají plat v rozmezí,
$\langle 8110;8402)$, platí, že status jejich pùjèky je dobrý.
\paragraph{}
Hypotéza s id 73 øíká:

\begin{description}
\item[Antecedent:] Salary($\langle 8110;8402)$) \& V-FFT-Bool([ant]: OP(VKLAD),  *** [succ]: amount(Nizky vklad)) \& District(Jicin)
\item[Sukcedent:] status(Bad)
\end{description}
kde pro virtuální atribut platí:
\begin{description}
\item[Antecedent:] OP(VKLAD)	
\item[Sukcedent:] amount(Nizky vklad)
\end{description}

Tato hypotéza mùže znamenat, že pro klienty z Jièína, kteøí \emph{mají tendenci vkládat na úèet menší èástky} a mají plat v rozmezí,
$\langle 8110;8402)$, platí, že status jejich pùjèky je špatný.
\paragraph{}
V obou uvedených hypotézách \uv{\emph{mají tendenci}} je pokusem o vysvìtlení významu hodnoty virtuálního atributu. Je vidìt, že
takové vysvìtlení je nepøesné (zde nalezené 4FT asociaèní pravidlo redukujeme na \emph{mít tendenci}) a velmi závisí na druhu zkoumaných dat.
	
\paragraph{}
Pro lepší objasnìní takto nalezených hypotéz se musí novì implementované relaèní rozšíøení vyzkoušet na jiných typech úloh
a dat. Databáze banky Barbora je fiktivní a navíc je pomìrnì malá -- autorovi se podaøilo pro testovací úèely vyrobit hlavní datovou matici
s potøebnými daty o velikosti kolem 700 øádkù. To není moc rozsáhlý datový soubor a uvážíme-li navíc fiktivnost údajù v tìchto maticích,
lze se domnívat, že výsledky úloh pro relaèní rozšíøení budou srozumitelnìjší a budou více odpovídat reálným faktùm pøi použití vìtších
a korektnìjších dat.


\section{Závìr}
\paragraph{}
Z provedených testù plyne, že doba bìhu pro obì úlohy záleží hlavnì
na poètu vygenerovaných virtuálních sloupcù. Velikost vedlejší datové matice
sice má na úlohu vliv, rozhodujícím faktorem však zùstává právì poèet vygenerovaných
sloupcù. To vyplývá ze zpùsobu,
jakým virtuální atribut funguje: pøi prvním generování spoèítá bitové øetízky
a uloží si je do bufferu, pøi dalších voláních se pracuje s bufferem. Proto
pøi rùzných velikostech vedlejší datové matice se úmìrnì mìní pouze
doba prvního generování.
\paragraph{}
Ukazuje se potøeba bufferu pro bitové øetízky generované
virtuálním atributem. Lze to zjistit jak z èasù v tabulce,
tak i z faktu, že pøi testování s vypnutou cache byl testovací
poèítaè pøi bìhu úlohy vytížen o poznání více.
\paragraph{}
Také je potøeba uvést, že implementace relaèních rozšíøení v rámci dané práce
je pilotní a chování úloh s hypotézovým virtuálním atributem vyžaduje další
zkoušení a zkoumání, stejnì jako tomu bylo v pøípadì jíž implementovaných
dataminingových úloh.
Pro lepší pochopení výsledkù obdržených pøi práci s relaèními rozšíøeními je tøeba dalšího zkoumání
na rùzných typech dat.